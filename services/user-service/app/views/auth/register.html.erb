<% content_for :title, t('auth.register.title', default: 'Sign Up') %>

<div class="calm-auth-container" data-controller="registration">
  <div class="calm-auth-card calm-auth-card-lg animate-fade-in">
    <!-- Logo and Welcome -->
    <div class="calm-auth-header">
      <div class="calm-auth-logo">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
          <path d="M20 8v6M23 11h-6"></path>
        </svg>
      </div>
      <h1 class="calm-auth-title"><%= t('auth.register.create_account', default: 'Create your account') %></h1>
      <p class="calm-auth-subtitle">
        <%= t('auth.register.subtitle', default: 'Join us for a peaceful experience') %>
      </p>
    </div>

    <!-- Registration Form -->
    <turbo-frame id="registration-form">
      <%= form_with(model: resource, 
                    as: resource_name, 
                    url: registration_path(resource_name),
                    data: { 
                      controller: "form-validation password-strength",
                      form_validation_realtime_value: true,
                      form_validation_submit_on_valid_value: false,
                      action: "form:valid->registration#handleValidForm"
                    }) do |f| %>
        
        <!-- Name Fields -->
        <div class="calm-form-row">
          <div class="calm-form-group">
            <%= f.label :first_name, class: "calm-form-label" %>
            <%= f.text_field :first_name, 
                            autofocus: true,
                            placeholder: t('auth.register.first_name_placeholder', default: 'John'),
                            class: "calm-form-input",
                            data: { 
                              form_validation_target: "field",
                              required: true,
                              min_length: 2,
                              required_message: t('validations.first_name_required'),
                              min_length_message: t('validations.name_min_length', count: 2)
                            },
                            "aria-describedby": "first-name-error" %>
            <span id="first-name-error" class="calm-form-error" hidden></span>
          </div>
          
          <div class="calm-form-group">
            <%= f.label :last_name, class: "calm-form-label" %>
            <%= f.text_field :last_name,
                            placeholder: t('auth.register.last_name_placeholder', default: 'Doe'),
                            class: "calm-form-input",
                            data: { 
                              form_validation_target: "field",
                              required: true,
                              min_length: 2,
                              required_message: t('validations.last_name_required'),
                              min_length_message: t('validations.name_min_length', count: 2)
                            },
                            "aria-describedby": "last-name-error" %>
            <span id="last-name-error" class="calm-form-error" hidden></span>
          </div>
        </div>

        <!-- Email Field -->
        <div class="calm-form-group">
          <%= f.label :email, class: "calm-form-label" %>
          <%= f.email_field :email, 
                           autocomplete: "email",
                           placeholder: t('auth.register.email_placeholder', default: 'your@email.com'),
                           class: "calm-form-input",
                           data: { 
                             form_validation_target: "field",
                             required: true,
                             email: true,
                             required_message: t('validations.email_required'),
                             email_message: t('validations.email_invalid')
                           },
                           "aria-describedby": "email-error" %>
          <span id="email-error" class="calm-form-error" hidden></span>
        </div>

        <!-- Phone Field (Optional) -->
        <div class="calm-form-group">
          <%= f.label :phone, class: "calm-form-label" do %>
            <%= t('auth.register.phone_label', default: 'Phone Number') %>
            <span class="calm-text-muted">(optional)</span>
          <% end %>
          <div class="calm-phone-input-wrapper">
            <span class="calm-phone-prefix">+91</span>
            <%= f.telephone_field :phone,
                                 placeholder: t('auth.register.phone_placeholder', default: '9876543210'),
                                 class: "calm-form-input calm-phone-input",
                                 maxlength: 10,
                                 pattern: "[6-9][0-9]{9}",
                                 data: { 
                                   form_validation_target: "field",
                                   pattern: "^[6-9][0-9]{9}$",
                                   pattern_message: t('validations.phone_invalid')
                                 },
                                 "aria-describedby": "phone-error" %>
          </div>
          <span id="phone-error" class="calm-form-error" hidden></span>
        </div>

        <!-- Password Field with Strength Indicator -->
        <div class="calm-form-group">
          <%= f.label :password, class: "calm-form-label" %>
          <%= f.password_field :password, 
                              autocomplete: "new-password",
                              placeholder: t('auth.register.password_placeholder', default: 'Create a strong password'),
                              class: "calm-form-input",
                              data: { 
                                form_validation_target: "field",
                                password_strength_target: "input",
                                required: true,
                                min_length: 8,
                                required_message: t('validations.password_required'),
                                min_length_message: t('validations.password_min_length', count: 8),
                                action: "input->password-strength#checkStrength"
                              },
                              "aria-describedby": "password-error password-strength" %>
          <span id="password-error" class="calm-form-error" hidden></span>
          
          <!-- Password Strength Indicator -->
          <div class="calm-password-strength" id="password-strength" data-password-strength-target="indicator">
            <div class="calm-strength-bar">
              <div class="calm-strength-fill" data-password-strength-target="fill"></div>
            </div>
            <p class="calm-strength-text" data-password-strength-target="text">
              <%= t('auth.register.password_strength', default: 'Password strength') %>: 
              <span data-password-strength-target="level">-</span>
            </p>
          </div>
        </div>

        <!-- Password Confirmation -->
        <div class="calm-form-group">
          <%= f.label :password_confirmation, class: "calm-form-label" %>
          <%= f.password_field :password_confirmation,
                              autocomplete: "new-password",
                              placeholder: t('auth.register.password_confirmation_placeholder', default: 'Confirm your password'),
                              class: "calm-form-input",
                              data: { 
                                form_validation_target: "field",
                                registration_target: "passwordConfirmation",
                                required: true,
                                required_message: t('validations.password_confirmation_required'),
                                action: "input->registration#validatePasswordMatch"
                              },
                              "aria-describedby": "password-confirmation-error" %>
          <span id="password-confirmation-error" class="calm-form-error" hidden></span>
        </div>

        <!-- Terms and Conditions -->
        <div class="calm-form-group">
          <label class="calm-checkbox-label">
            <%= f.check_box :terms_accepted, 
                           class: "calm-checkbox",
                           data: { 
                             form_validation_target: "field",
                             required: true,
                             required_message: t('validations.terms_required')
                           } %>
            <span>
              <%= t('auth.register.agree_to', default: 'I agree to the') %>
              <%= link_to t('auth.register.terms', default: 'Terms of Service'), 
                         terms_path, 
                         class: "calm-link", 
                         target: "_blank",
                         data: { turbo: false } %>
              <%= t('auth.register.and', default: 'and') %>
              <%= link_to t('auth.register.privacy', default: 'Privacy Policy'), 
                         privacy_path, 
                         class: "calm-link", 
                         target: "_blank",
                         data: { turbo: false } %>
            </span>
          </label>
          <span id="terms-error" class="calm-form-error" hidden></span>
        </div>

        <!-- Submit Button -->
        <div class="calm-form-actions">
          <%= f.submit t('auth.register.create_account_button', default: 'Create Account'), 
                      class: "calm-btn calm-btn-primary calm-btn-block calm-btn-lg",
                      data: { 
                        form_validation_target: "submit",
                        registration_target: "submitButton"
                      } %>
        </div>
      <% end %>
    </turbo-frame>

    <!-- Additional Links -->
    <div class="calm-auth-footer">
      <p>
        <%= t('auth.register.have_account', default: 'Already have an account?') %>
        <%= link_to t('auth.register.sign_in', default: 'Sign in'), 
                   new_session_path(resource_name), 
                   class: "calm-link calm-link-primary",
                   data: { turbo_frame: "_top" } %>
      </p>
    </div>
  </div>
</div>

<style>
  /* Registration specific styles */
  .calm-auth-card-lg {
    max-width: 520px;
  }
  
  .calm-form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
  
  /* Password strength indicator */
  .calm-password-strength {
    margin-top: 0.5rem;
  }
  
  .calm-strength-bar {
    height: 4px;
    background: var(--calm-gray-200);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 0.5rem;
  }
  
  .calm-strength-fill {
    height: 100%;
    width: 0;
    transition: width 0.3s ease, background-color 0.3s ease;
  }
  
  .calm-strength-fill[data-strength="0"] {
    width: 0;
  }
  
  .calm-strength-fill[data-strength="1"] {
    width: 25%;
    background-color: var(--calm-danger);
  }
  
  .calm-strength-fill[data-strength="2"] {
    width: 50%;
    background-color: var(--calm-warning);
  }
  
  .calm-strength-fill[data-strength="3"] {
    width: 75%;
    background-color: var(--calm-info);
  }
  
  .calm-strength-fill[data-strength="4"] {
    width: 100%;
    background-color: var(--calm-success);
  }
  
  .calm-strength-text {
    font-size: 0.75rem;
    color: var(--calm-gray-600);
  }
  
  /* Form validation states */
  .calm-form-input.success {
    border-color: var(--calm-success);
  }
  
  .calm-form-input.error {
    border-color: var(--calm-danger);
  }
  
  /* Mobile responsive */
  @media (max-width: 480px) {
    .calm-form-row {
      grid-template-columns: 1fr;
    }
  }
</style>