<div class="language-switcher" data-controller="dropdown">
  <button type="button" 
          class="calm-btn calm-btn-sm"
          data-dropdown-target="button"
          data-action="click->dropdown#toggle click@window->dropdown#close"
          aria-expanded="false"
          aria-haspopup="true">
    <% case I18n.locale %>
    <% when :en %>
      <span class="language-flag">🇺🇸</span>
      <span class="language-name"><%= t('common.english') %></span>
    <% when :hi %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name"><%= t('common.hindi') %></span>
    <% when :te %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name"><%= t('common.telugu') %></span>
    <% when :kn %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name"><%= t('common.kannada') %></span>
    <% when :ta %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name"><%= t('common.tamil') %></span>
    <% when :ml %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name"><%= t('common.malayalam') %></span>
    <% else %>
      <span class="language-flag">🇺🇸</span>
      <span class="language-name"><%= t('common.english') %></span>
    <% end %>
    <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>
  
  <div class="dropdown-menu hidden" data-dropdown-target="menu" role="menu">
    <%= link_to change_language_path(:en), 
        class: "dropdown-item #{I18n.locale == :en ? 'active' : ''}", 
        data: { turbo_method: :post, turbo_action: "replace" },
        role: "menuitem" do %>
      <span class="language-flag">🇺🇸</span>
      <span class="language-name">English</span>
      <% if I18n.locale == :en %>
        <span class="check-icon">✓</span>
      <% end %>
    <% end %>
    
    <%= link_to change_language_path(:hi), 
        class: "dropdown-item #{I18n.locale == :hi ? 'active' : ''}", 
        data: { turbo_method: :post, turbo_action: "replace" },
        role: "menuitem" do %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name">हिंदी</span>
      <% if I18n.locale == :hi %>
        <span class="check-icon">✓</span>
      <% end %>
    <% end %>
    
    <%= link_to change_language_path(:te), 
        class: "dropdown-item #{I18n.locale == :te ? 'active' : ''}", 
        data: { turbo_method: :post, turbo_action: "replace" },
        role: "menuitem" do %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name">తెలుగు</span>
      <% if I18n.locale == :te %>
        <span class="check-icon">✓</span>
      <% end %>
    <% end %>
    
    <%= link_to change_language_path(:kn), 
        class: "dropdown-item #{I18n.locale == :kn ? 'active' : ''}", 
        data: { turbo_method: :post, turbo_action: "replace" },
        role: "menuitem" do %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name">ಕನ್ನಡ</span>
      <% if I18n.locale == :kn %>
        <span class="check-icon">✓</span>
      <% end %>
    <% end %>
    
    <%= link_to change_language_path(:ta), 
        class: "dropdown-item #{I18n.locale == :ta ? 'active' : ''}", 
        data: { turbo_method: :post, turbo_action: "replace" },
        role: "menuitem" do %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name">தமிழ்</span>
      <% if I18n.locale == :ta %>
        <span class="check-icon">✓</span>
      <% end %>
    <% end %>
    
    <%= link_to change_language_path(:ml), 
        class: "dropdown-item #{I18n.locale == :ml ? 'active' : ''}", 
        data: { turbo_method: :post, turbo_action: "replace" },
        role: "menuitem" do %>
      <span class="language-flag">🇮🇳</span>
      <span class="language-name">മലയാളം</span>
      <% if I18n.locale == :ml %>
        <span class="check-icon">✓</span>
      <% end %>
    <% end %>
  </div>
</div>

<style>
  .language-switcher {
    position: relative;
  }
  
  .language-flag {
    margin-right: 0.5rem;
    font-size: 1.1em;
  }
  
  .language-name {
    font-weight: 500;
  }
  
  .dropdown-arrow {
    margin-left: 0.5rem;
    width: 1rem;
    height: 1rem;
    transition: transform 0.2s ease;
  }
  
  .dropdown-menu {
    position: absolute;
    right: 0;
    top: 100%;
    margin-top: 0.5rem;
    min-width: 12rem;
    background-color: white;
    border: 1px solid var(--calm-gray-200);
    border-radius: var(--calm-radius-md);
    box-shadow: var(--calm-shadow-lg);
    z-index: 50;
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease;
  }
  
  .dropdown-menu:not(.hidden) {
    opacity: 1;
    transform: translateY(0);
  }
  
  .dropdown-item {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    text-decoration: none;
    color: var(--calm-gray-700);
    transition: background-color 0.2s ease;
    position: relative;
  }
  
  .dropdown-item:hover {
    background-color: var(--calm-gray-50);
  }
  
  .dropdown-item.active {
    background-color: var(--calm-primary-light);
    background-color: rgba(91, 143, 185, 0.1);
    color: var(--calm-primary);
  }
  
  .dropdown-item:first-child {
    border-top-left-radius: var(--calm-radius-md);
    border-top-right-radius: var(--calm-radius-md);
  }
  
  .dropdown-item:last-child {
    border-bottom-left-radius: var(--calm-radius-md);
    border-bottom-right-radius: var(--calm-radius-md);
  }
  
  .check-icon {
    margin-left: auto;
    color: var(--calm-primary);
    font-weight: bold;
  }
  
  /* Mobile responsive */
  @media (max-width: 768px) {
    .language-name {
      display: none;
    }
    
    .dropdown-menu {
      left: auto;
      right: -1rem;
    }
  }
</style>